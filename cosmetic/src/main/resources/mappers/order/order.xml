<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">

<!-- 데이터 입력시 새로 생성된 primary key 가져오기 -->
<select id="getId" resultType="int">
	select LAST_INSERT_ID()
</select>
<select id="getOrderId" resultType="long">
	SELECT orderid FROM orderList ORDER BY orderid DESC LIMIT 1
</select>

<select id="memberInfo" resultType="java.util.Map">
	SELECT NAME, phone, zipcode, address1, address2 FROM member
	WHERE userid=#{userid}
</select>

<!-- 장바구니의 상품 > 주문 아이템 테이블에 저장 -->
<insert id="orderItemInsert">
	INSERT INTO orderitem(
	p_id, amount, orderstatus
	) VALUES (
		#{p_id}, #{amount}, #{orderstatus}
	)
</insert>

<!-- 주문한 상품 목록 확인 -->
<select id="orderItems" resultType="java.util.Map">
	select * from orderitem
	where orderItemId = #{itemId}
</select>

<!-- 상품정보 가져오기 -->
<select id="orderedProducts" resultType="java.util.Map">
	select * from product
	where p_id = #{p_id}
</select>

<!-- 주문테이블 데이터 입력 -->
<insert id="orderInsert">
	INSERT INTO orderlist (
		userid, orderItemId,
        price, deliverCost, totalPrice,
        method,
        username, zipcode, address1, address2, tel,
        userPoint
	) VALUES (
		#{userid}, #{orderItemId},
	    #{price}, #{deliverCost}, #{totalPrice},
	    #{method},
	    #{username}, #{zipcode}, #{address1}, #{address2}, #{tel},
	    #{userPoint}
	)
</insert>

<!-- 주문결과 확인 -->
<select id="orderSelect" resultType="com.example.cosmetic.model.order.OrderDTO">
	select * from orderlist
	where orderId = #{orderid}
</select>

<!-- 포인트 적립 -->
<update id="pointUpdate">
	UPDATE MEMBER
	SET POINT = POINT + #{point}
	WHERE userid = #{userid}
</update>

<!-- 적립된 포인트 보여주기 -->
<select id="showPoint" resultType="int">
	select POINT from member
	where userid = #{userid}
</select>

<!-- 주문 목록 출력 -->
<select id="orderList" resultType="com.example.cosmetic.model.order.OrderDTO">
	select * from orderlist
	where userid = #{userid}
	ORDER BY orderDate
</select>

<!-- 주문된 상품 카트에서 지우기 -->
<delete id="cartDelete">
	delete from cart
	where c_id=#{c_id}
</delete>

<!-- 상품리스트에서 주문 아이템 삭제 -->
<delete id="orderItemDelete">
	DELETE FROM orderitem
	WHERE orderItemId = #{orderItemId}
</delete>

<!-- 주문 리스트에서 특정 주문 삭제 -->
<delete id="orderDelete">
	DELETE FROM orderlist
	where orderid = #{orderid}
</delete>

<!-- 주문 리스트에서 주문 아이템 id 선택 -->
<select id="orderItemIdSelect" resultType="String">
	select orderItemId from orderlist
	where orderid = #{orderid}
</select>

<!-- 주문 리스트 업데이트 -->
<update id="orderlistUpdate">
	UPDATE orderlist
	SET orderItemId = CAST(#{orderItemId} AS JSON)
	WHERE orderid = #{orderid}
</update>

</mapper>